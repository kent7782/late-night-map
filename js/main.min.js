function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:startPosition,zoom:9,mapTypeControl:!1,styles:initialStyle,draggableCursor:"crosshair",disableDoubleClickZoom:!0}),defaultIcon={path:google.maps.SymbolPath.CIRCLE,fillColor:"#FFFFFF",fillOpacity:.4,scale:9,strokeColor:"#212121",strokeWeight:.2},locateUser(),infoWindow=new google.maps.InfoWindow,service=new google.maps.places.PlacesService(map),searchForm.addEventListener("submit",function(e){e.preventDefault(),infoWindow.close(),searchPlaces()}),map.addListener("click",function(){infoWindow.close()}),map.addListener("dblclick",function(e){dropPin(e.latLng,map),infoWindow.close()}),locateBtn.addEventListener("click",function(e){e.preventDefault(),infoWindow.close(),locatingIsDisabled?showMessageAndHide("Please enable location tracking on your browser.",3e3):locateUser()})}function locateUser(){currentMarker?repositionMap(currentPosition):navigator.geolocation?(showMessage("Locating.."),navigator.geolocation.getCurrentPosition(function(e){currentPosition={lat:e.coords.latitude,lng:e.coords.longitude},searchPlaces(currentPosition),map.setOptions({styles:mainStyle}),createCurrentMarker(currentPosition)},function(){locatingIsDisabled=!0,map.setOptions({styles:mainStyle}),hideMessage()})):(showMessageAndHide("Your browser does not support location",3500),map.setOptions({styles:mainStyle}))}function dropPin(e,o){o.panTo(e),pin?pin.setPosition(e):pin=new google.maps.Marker({position:e,icon:modifyIcon(defaultIcon,{fillColor:"red",scale:10}),map:o}),hideMessage()}function searchPlaces(e){if(keyword=document.getElementById("search-box").value,!keyword)return void showMessageAndHide("Please enter a keyword.",2e3);prevKeyword&&prevKeyword!==keyword&&clearPlaceMarkers();var o=15e4,n={location:"",radius:o/map.getZoom(),keyword:keyword,openNow:!0};if(e)n.location=e;else{if(!pin)return void showMessageAndHide("Double-click on the map to drop a pin for searching.",3500);var t=new google.maps.LatLng(pin.getPosition().lat(),pin.getPosition().lng());n.location=t}requestPlaces(n),repositionMap(n.location),prevKeyword=keyword}function requestPlaces(e){showMessage("Searching.."),service.radarSearch(e,function(e,o,n){o==google.maps.places.PlacesServiceStatus.OK?(displayPlaceMarkers(e),showMessageAndHide(e.length+' "'+keyword+'" places are still open.',3e3)):showMessageAndHide("No place found.. Zoom to another area and try again.",3500)})}function displayPlaceMarkers(e){for(var o=0;o<e.length;o++){var n=e[o],t=n.geometry.location,a=new google.maps.LatLng(t.lat(),t.lng());placeIds[n.place_id]||(createPlaceMarker(a,n),placeIds[n.place_id]=n)}}function createPlaceMarker(e,o){var n=modifyIcon(defaultIcon,{fillColor:"#FFFF00"}),t=modifyIcon(n,{scale:n.scale+3}),a=new google.maps.Marker({position:e,icon:n,map:map});placeMarkers.push(a),a.addListener("mouseover",function(){this.setIcon(t)}),a.addListener("mouseout",function(){this.setIcon(n)}),a.addListener("click",function(){requestPlaceDetail(o.place_id,function(e){openInfoWindow(this,e)}.bind(this))})}function createCurrentMarker(e){var o=modifyIcon(defaultIcon,{fillColor:"blue",fillOpacity:.3,scale:10}),n=modifyIcon(o,{scale:13});currentMarker=new google.maps.Marker({position:e,icon:o,map:map}),currentMarker.addListener("mouseover",function(){this.setIcon(n)}),currentMarker.addListener("mouseout",function(){this.setIcon(o)}),currentMarker.addListener("click",function(){infoWindow.setContent("<p>You're here, in the dark.<p>"),infoWindow.open(map,this)})}function requestPlaceDetail(e,o){if(placeDetails[e])o(placeDetails[e]);else{var n={placeId:e};service.getDetails(n,function(n,t){o(n),placeDetails[e]=n})}}function openInfoWindow(e,o){var n='<div class="info-window"><h1 class="info-header">'+o.name+'</h1><div class="info-content"><p><b>Address: </b>'+o.formatted_address+'</p><p id="phone"><b>Phone Number: </b>'+o.formatted_phone_number+"</p><p><b>Hours Today: </b>"+o.opening_hours.weekday_text[getAdjustedDayIndex()]+'</p><p id="website"><a href="'+o.website+'" target="_blank">Visit Webstie</a></p></div></div>';infoWindow.setContent(n),infoWindow.open(map,e),o.website||(document.getElementById("phone").style.display="none"),o.website||(document.getElementById("website").style.display="none")}function showMessage(e){messageLabel.innerHTML=e,searchBtn.style.display="none",searchBox.style.display="none",locateBtn.style.display="none",messageLabel.style.display="inline-block"}function hideMessage(){searchBtn.style.display="inline-block",searchBox.style.display="inline-block",locateBtn.style.display="inline-block",messageLabel.style.display="none"}function showMessageAndHide(e,o){showMessage(e),setTimeout(function(){hideMessage()},o)}function repositionMap(e){map.panTo(e),smoothZoom(map,14,map.getZoom())}function smoothZoom(e,o,n){n>=o||(z=google.maps.event.addListener(e,"zoom_changed",function(t){google.maps.event.removeListener(z),smoothZoom(e,o,n+1)}),setTimeout(function(){e.setZoom(n)},65))}function clearPlaceMarkers(){setMapOnAll(null),placeIds={},placeMarkers=[]}function setMapOnAll(e){for(var o=0;o<placeMarkers.length;o++)placeMarkers[o].setMap(e)}function modifyIcon(e,o){return Object.assign({},e,o)}function getAdjustedDayIndex(){var e;const o=1,n=1;return e=hour<=5?today-o-n:today-o,e<0&&(e+=7),e}var map,service,startPosition={lat:37.9,lng:-122.9},locatingIsDisabled=!1,keyword,prevKeyword,pin,infoWindow,currentMarker,currentPosition,placeMarkers=[],placeDetails={},placeIds={},defaultIcon={},date=new Date,today=date.getDay(),hour=date.getHours(),searchForm=document.getElementById("search-form"),searchBox=document.getElementById("search-box"),searchBtn=document.getElementById("search-btn"),locateBtn=document.getElementById("locate-btn"),messageLabel=document.getElementById("message");